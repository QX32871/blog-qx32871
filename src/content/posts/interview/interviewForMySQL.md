---
title: MySQL面试题
published: 2024-11-03
description: 'MySQL八股学习'
image: './MySQL-Image.png'
tags: ["八股","MySQL"]
category: '八股'
draft: false 
lang: 'zh_CN'
---
### 如何定位慢查询

- 当发现存在慢查询的时候，首先如果系统中采用了如Skywalking之类的运维工具，那么就可以使用这些运维工具的图形化界面来监控分析接口的运行时长组成，这样就可以发现是不是SQL造成的接口访问缓慢的问题。
- 也可以使用MySQL自带的慢查询日志，这个慢查询日志不是默认开启的，需要在MySQL的配置文件里面手动开启和设置查询超过多少时间就记录，比如说可以设置成2秒，意思就是如果一个SQL语句执行的时间超过2秒就会被记录到日志里面。不过这种方法最好只在调试阶段使用，因为开启这个日志会损耗一定的性能

### 分析SQL为什么执行得慢

可以查看SQL的执行计划来帮助分析SQL语句执行慢的原因，具体操作就是在Select语句前加上“EXPLAIN”关键字来查看分析。

- 可以关注key和key_len来检查这条语句是否命中索引或者判断索引是否失效，如果出现这些情况的话就可以添加索引或者检查SQL语句是否出错来优化语句。
- 通过type字段来检查是不是还有优化空间，是否存在全盘扫描等情况
- 通过extra来判断是不是出现了回表的情况，如果出现了话可以尝试添加索引或者修改返回字段来优化SQL

### 索引是什么？

索引是可以帮助数据库高效查询的数据结构，主要用于提高数据查询的效率，降低性能开销。

### 索引的底层数据结构

MySQL默认存储引擎InnoDB采用的索引数据结构是B+树，原因是B+树查询的路径更短，硬盘读写的开销低，只在叶子结点存储数据，其他节点只存储指针。

### B树和B+树的区别

B树在非叶子节点和叶子结点上都会存储数据，而B+树只会在叶子结点上存储数据，在查询的时候B+树的查找效率会更加稳定。
在进行范围查询的时候，因为B+树只在叶子结点存储数据的特点，而所有的叶子结点组成的是一个双向链表，所以存储的效率会更高。

### 什么是聚簇索引？什么是非聚簇索引？

- 聚簇索引是索引和数据放在一起，B+树的叶子节点存储的是索引和数据，一个表中只能有一个聚簇索引。
- 非聚簇索引是指索引和数据分开存储，B+树的叶子节点保存的是索引和主键，一个表可以有多个非聚簇索引。

### 什么是回表查询

- 回表查询是跟聚簇索引和非聚簇索引有关系的，回表查询就是通过二级索引找到对应的主键值，然后再通过主键值找到聚集索引中所对应的整行数据，这个操作就是回表。
- 简单来说就是使用索引查询到主键之后，为了获取完整的行数据需要再去原来的表里面通过主键来查找剩下的信息

### 什么是覆盖索引？

覆盖索引是指使用了索引查询的时候返回的列可以一次在全找到，满足覆盖索引的查询性能会较高，但是有可能会触发回表查询，这样的话性能就比较低了，要避免发生这种情况的话最好在编写SQL语句的时候尽量手动指定要查询的列，避免使用```select *``` 。

### 超大分页怎么处理？

使用覆盖索引+子查询
先分页查询获取表中的ID，并且对这个ID进行排序，就可以筛选出分页之后的ID集合，因为ID是覆盖索引，因此操作的效率会高很多。最后通过ID集合去到原来的表中再进行关联查询。

### 索引的创建要注意什么？

- 索引一般建立在需要频繁查询的字段上，索引可以提高查询的效率，但会降低增删改的效率，因为需要动态的维护索引
- 正因为索引需要花性能和空间去维护，所以需要控制索引的数量
- 在单表数据超过10万这个前提才推荐去创建索引，并且最好创建联合索引，并且注意不要在低区分度的字段上创建索引。
- 推荐有唯一性的列作为索引，并且尽量不使用无序的值作为索引

### 索引失效的情况
- 违反最左前缀法则
- 使用范围查询时，右边的列的索引会失效
- 在索引列上进行运算操作的时候索引会失效
- 条件中字符串不加单引号导致发生类型转换，索引会失效
- 以%号开头的模糊查询索引会失效，但是%号在最后面的模糊查询索引不会失效